#!/bin/sh
if [ "$CI" = "true" ]; then
  echo "Skipping pre-push hooks in CI..."
  exit 0
fi

echo "üßπ Cleaning node_modules and pnpm-lock.yaml..."
rm -rf node_modules pnpm-lock.yaml

echo "üì¶ Reinstalling dependencies to ensure lock file is up-to-date..."
pnpm install --frozen-lockfile=false

echo "‚úÖ Checking if pnpm-lock.yaml was updated..."
if ! git diff --exit-code pnpm-lock.yaml > /dev/null 2>&1; then
  echo "‚ö†Ô∏è  pnpm-lock.yaml was updated! Please review and commit the changes:"
  echo ""
  git diff --stat pnpm-lock.yaml
  echo ""
  echo "Run the following commands:"
  echo "  git add pnpm-lock.yaml"
  echo "  git commit -m 'chore: update pnpm-lock.yaml'"
  echo ""
  exit 1
fi

echo "üîç Running pre-push validations..."
pnpm exec changeset status

